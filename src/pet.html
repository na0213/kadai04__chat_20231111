<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Document</title>
    <link rel="stylesheet" href="../css/reset.css">
    <link rel="stylesheet" href="../css/pet.css">
    <link rel="stylesheet" href="./vendor/tailwind/tailwind.css">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.2/css/all.min.css" integrity="sha512-z3gLpd7yknf1YoNbCzqRKc4qyor8gaKU1qmn+CShxbuBusANI9QpRohGBreCFkKxLhei6S9CQXFEbbKuqLg0DA==" crossorigin="anonymous" referrerpolicy="no-referrer" />

</head>
<header>

</header>
<body>
    <h1><span class="first-p">P</span>ET <span class="first-c">C</span>HAT</h1>
    <!-- コンテンツ表示画面 -->
    <div class="container">
        <div class="side">
            <ul>
              <li class="mt-3 ml-3 mb-3">
                  <a id="friends" href="index.html">FRIENDS</a>
              </li>
              <li class="mt-3 ml-3 mb-3">
                  <a id="pets" href="pet.html">PET</a>
              </li>
              <li class="mt-3 ml-3 mb-3">
                  <a id="storage" href="storage.html">保存</a>
              </li>
            </ul>
        </div>

        <select id="petType">
            <option value="">ペットの種類</option>
            <option value="犬">犬</option>
            <option value="猫">猫</option>
            <option value="フェレット">フェレット</option>
            <!-- 他のペットの種類を追加可能 -->
        </select>
        <br />
        <input type="text" id="petName" placeholder="ペットの名前">
        <br />
        <button id="submitBtn">登録</button>

        <div class="chat_body">
            <div id=""></div>
            <div class="message">
                <div class="me">
                    <textarea id="request_text" placeholder="文章を入力してください"></textarea>
                    <input type="button" onClick="reply()" value="話しかける" />
                    <br /><br />
                    <!-- <a href="#" id="send" class="btn-social-circle btn-social-circle--twitter">
                        <i class="fa-regular fa-paper-plane"></i>
                        <input id="uname" style="display: none;">
                    </a> -->
                </div>
                <textarea id="response_text" cols="100" rows="10" disabled>
                </textarea>
            </div>
        </div>
        
    </div>

    <script src="https://ajax.googleapis.com/ajax/libs/jquery/3.6.0/jquery.min.js"></script>
    <script type="module">
        // Import the functions you need from the SDKs you need
        import { initializeApp } from "https://www.gstatic.com/firebasejs/9.1.0/firebase-app.js";
        import { getDatabase, ref, push, set, onChildAdded, remove, onChildRemoved }
            from "https://www.gstatic.com/firebasejs/9.1.0/firebase-database.js";
        // Your web app's Firebase configuration
        const firebaseConfig = {
            apiKey: env('FIREBASE_API_KEY'),
            authDomain:  env('FIREBASE_AUTH_DOMAIN'),
            databaseURL: env('FIREBASE_DATABASE_URL'),
            projectId: env('FIREBASE_PROJECT_ID'),
            storageBucket: env('FIREBASE_STORAGE_BUCKET'),
            messagingSenderId: env('FIREBASE_MESSAGING_SENDER_ID'),
            appId: env('FIREBASE_APP_ID'),
        };
        const app = initializeApp(firebaseConfig); //鍵を開ける
        const db = getDatabase(app); //RealtimeDBに接続
        const dbRef = ref(db, "chat"); //RealtimeDB内の"chat"を使う　”natus"でもよい

        // ペット登録
        document.getElementById('submitBtn').addEventListener('click', function() {
            var petType = document.getElementById('petType').value;
            var petName = document.getElementById('petName').value;

            if (petType && petName) {
                const API_KEY = env('OPENAI_API_KEY');
                const URL = env('OPENAI_API_URL');

                function reply() {
                    var text = document.getElementById("request_text").value;
                    async function getResponse() {
                        try {
                            const response = await axios.post(
                                URL,
                                {
                                    "model": "gpt-3.5-turbo",
                                    "messages": [
                                        { "role": "user", "content": text }
                                    ]
                                },
                                {
                                    headers: {
                                        "Content-Type": "application/json",
                                        Authorization: `Bearer ${API_KEY}`,
                                    },
                                }
                            );
                            var chatgpt_response = response.data.choices[0].message.content;
                            $("#response_text").val(chatgpt_response);
                        } catch (error) {
                            console.log(error);
                        }
                    }
                    getResponse();
                }
                // var prompt = `あなたは${petType}の${petName}となり、会話をしてください。`;

                // const api_key = "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";

                // const sendButton = document.querySelector(".send");
                // sendButton.addEventListener("click", async () => {
                // const text = document.querySelector("[name=talk]");
                // const responseText = await requestChatAPI(text.value);
                // const output = document.querySelector(".output");
                // output.textContent = responseText;
                // });
                // // ChatGPT API との連携コードをここに追加
                // // 例: sendPromptToChatGPT(prompt);
                // function sendPromptToChatGPT(prompt) {
                //     // ここにAPIへのリクエスト処理を追加
                // }

                // console.log(prompt); // 実際にはAPIに送信
            } else {
                alert('すべての項目を入力してください。');
            }
        });


        //データ登録(Click)
        // $('#send').on('click', function(){
        //     const uname = $('#uname').val();
        //     const text = $('#text').val();
        //     // const date = $('#date').val();

        //     console.log(uname, 'unameの文字')
        //     console.log(text, 'textの文字')

        //     // firebaseにデータを送る
        //     const msg = {
        //         uname: uname,  //普通は、uname: uname,
        //         text: text,  //普通は、text: text,と書いて、わかりやすいようにする
        //         // date: date,
        //     }

        //     // firebaseにデータを送る処理
        //     // pushはfirebase が用意したおまじない
        //     const newPostRef = push(dbRef); //firebase公式の書き方 JSとは違う
        //     // setはfirebase が用意したおまじない
        //     set(newPostRef, msg);


        //     // 送信を押したら入力された文字を消す
        //     $('#uname').val("");
        //     $('#text').val("");
        // })

        
        //データ登録(Enter)

        //最初にデータ取得＆onSnapshotでリアルタイムにデータを取得
        // onChildAdded(dbRef, function(data) { //成功したらdataにデータが入る onChildAddedはfirebaseのもの、JSではない
        //     const msg = data.val();
        //     console.log(msg);
        //     const key = data.key;

        //     console.log(msg.text);

        //     const retext = msg.text
        //         .replace(/疲れた/g,'ベホイミ')
        //         .replace(/無理じゃない？/g,'諦めたらそこで試合終了ですよ')
        //         .replace(/うざ/g,'存在感すご')
            
        //     let html = `
        //     <div class=${key}>
        //         <p>${msg.uname}</p>
        //         <p>${retext}</p>
        //     </div>
        //     `

        //     $('#output').append(html)
        // })


    </script>

</body>
</html>